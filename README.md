# KBase Elasticsearch Indexer

This is a persistent process written in Python that consumes Kafka events generated by the KBase Workspace server, and publishes documents to be indexed back to another kafka topic, to be consumed by the [elasticsearch-writer](https://github.com/kbaseIncubator/elasticsearch_writer).

## Development

Start the servers:

```sh
docker-compose up
```

Run the tests (servers must be running):

```sh
make test
```

### Deployment

Build the image:

```sh
IMAGE_NAME=kbase/index_runner2:{VERSION} sh hooks/build
```

Push to docker hub

```sh
docker push kbase/index_runner2:{VERSION}
```

### Project anatomy

* The main process and entrypoint for the app lives in `./src/index_runner/main.py`
* The workspace events consumer is in `./src/index_runner/workspace_consumer.py`
* The elasticsearch updates consumer is in `./src/index_runner/elasticsearch_consumer.py`

## KBase Search Stack

* [Index Runner](https://github.com/kbaseIncubator/index_runner_deluxe) - Kafka consumer to construct indexes and documents.
* [Elasticsearch Writer](https://github.com/kbaseIncubator/elasticsearch_writer<Paste>) - Kafka consumer to bulk update documents in ES.
* [Search API](https://github.com/kbaseIncubator/search_api_deluxe) - HTTP API for performing search queries.
* [Search Config](https://github.com/kbaseIncubator/search_config) - Global search configuration.
